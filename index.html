<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz K3 Nasional 2026</title>

<style>
body {
  font-family: Arial, sans-serif;
  padding: 15px;
  text-align: center;
}

h1 { font-size: 22px; margin-bottom: 4px; }
h2 { font-size: 15px; margin-top: 0; }

input, button {
  padding: 8px;
  font-size: 16px;
  margin: 4px;
}

table {
  border-collapse: collapse;
  margin: auto;
}

td {
  border: 1px solid #000;
  width: 32px;
  height: 32px;
  font-weight: bold;
  text-align: center;
}

.highlight {
  background: #c8e6c9;
}

@media (max-width: 768px) {
  td {
    width: 5vw;
    height: 5vw;
    font-size: 3vw;
  }
}
</style>
</head>

<body>

<h1>QUIZ K3 NASIONAL 2026</h1>
<h2>RS Premier Jatinegara</h2>

<input id="playerName" placeholder="Nama peserta"><br>
<input id="searchWord" placeholder="Cari kata">
<button onclick="searchWord()">Cari</button>

<div><b>Waktu:</b> <span id="time">10:00</span></div>
<div><b>Skor:</b> <span id="score">0</span></div>
<div id="message"></div>

<table id="grid"></table>

<script>
/* ================= GOOGLE SHEET ================= */
const SHEET_URL = "https://script.google.com/macros/s/AKfycbzA5b3WhsI7SrBZE2S0GH-ti9o70AljoPBdUPTDvAvg72yPPR-10Zx93DO1u6kqyuBR/exec";

/* ================= KONFIG ================= */
const VALID_WORDS = [
 "K3","APAR","ISOLASI","PPE","JSA","DAMKAR","HYDRANT",
 "RADIOLOGI","EMERGENCY","INTENSIVE","REHABILITASI",
 "STETOSKOP","INFUS","CTSCAN","PREMIER","JATINEGARA",
 "KESELAMATAN","KESEHATAN","RISIKO","PROSEDUR",
 "PELINDUNG","KERJA","LINGKUNGAN","EVAKUASI",
 "KEBAKARAN","INSIDEN","PENCEGAHAN","EDUKASI",
 "INSPEKSI","MONITORING"
];

const SIZE = 20;
const DIR = [[0,1],[1,0],[-1,1]];

let score = 0;
let timeLeft = 600;
let gameOver = false;

const foundWords = new Set();
const permanent = new Set();

/* ================= GRID ================= */
const grid = Array.from({length: SIZE}, () => Array(SIZE).fill(""));
const rand = n => Math.floor(Math.random()*n);

function placeWord(word){
  for(let t=0;t<300;t++){
    let [dr,dc]=DIR[rand(3)], r=rand(SIZE), c=rand(SIZE);
    let ok=true;
    for(let i=0;i<word.length;i++){
      let nr=r+i*dr,nc=c+i*dc;
      if(nr<0||nc<0||nr>=SIZE||nc>=SIZE ||
        (grid[nr][nc] && grid[nr][nc]!==word[i])) {
        ok=false; break;
      }
    }
    if(ok){
      for(let i=0;i<word.length;i++)
        grid[r+i*dr][c+i*dc]=word[i];
      return;
    }
  }
}

VALID_WORDS.forEach(placeWord);

for(let r=0;r<SIZE;r++)
 for(let c=0;c<SIZE;c++)
  if(!grid[r][c])
    grid[r][c]=String.fromCharCode(65+rand(26));

const table=document.getElementById("grid");
const cells=[];

grid.forEach((row,r)=>{
  const tr=document.createElement("tr");
  cells[r]=[];
  row.forEach((ch,c)=>{
    const td=document.createElement("td");
    td.textContent=ch;
    tr.appendChild(td);
    cells[r][c]=td;
  });
  table.appendChild(tr);
});

/* ================= GAME ================= */
function clearTemp(){
  cells.flat().forEach((td,i)=>{
    if(!permanent.has(i)) td.classList.remove("highlight");
  });
}

function searchWord(){
  if(gameOver) return;

  const w=document.getElementById("searchWord").value.toUpperCase().trim();
  const msg=document.getElementById("message");

  clearTemp();

  if(!VALID_WORDS.includes(w)){
    msg.textContent="Kata tidak termasuk jawaban";
    return;
  }

  if(foundWords.has(w)){
    msg.textContent="Kata sudah ditemukan";
    return;
  }

  for(let r=0;r<SIZE;r++){
    for(let c=0;c<SIZE;c++){
      for(let [dr,dc] of DIR){
        let ok=true, pos=[];
        for(let i=0;i<w.length;i++){
          let nr=r+i*dr,nc=c+i*dc;
          if(nr<0||nc<0||nr>=SIZE||nc>=SIZE||grid[nr][nc]!==w[i]){
            ok=false; break;
          }
          pos.push([nr,nc]);
        }
        if(ok){
          pos.forEach(([rr,cc])=>{
            let idx=rr*SIZE+cc;
            permanent.add(idx);
            cells[rr][cc].classList.add("highlight");
          });
          foundWords.add(w);
          score+=10;
          document.getElementById("score").textContent=score;
          msg.textContent="Benar! +10 poin";
          return;
        }
      }
    }
  }
  msg.textContent="Belum ditemukan di grid";
}

/* ================= TIMER ================= */
setInterval(()=>{
  if(gameOver) return;
  timeLeft--;
  document.getElementById("time").textContent =
    String(Math.floor(timeLeft/60)).padStart(2,"0")+":"+
    String(timeLeft%60).padStart(2,"0");

  if(timeLeft<=0) endGame();
},1000);

function endGame(){
  gameOver=true;
  document.getElementById("searchWord").disabled=true;

  const nama=document.getElementById("playerName").value || "Tanpa Nama";

  fetch(SHEET_URL,{
    method:"POST",
    body:JSON.stringify({
      nama:nama,
      skor:score,
      jumlah:foundWords.size
    }),
    headers:{ "Content-Type":"application/json" }
  });

  document.getElementById("message").textContent =
    `Selesai! ${nama} | Skor akhir: ${score}`;
}
</script>

</body>
</html>
